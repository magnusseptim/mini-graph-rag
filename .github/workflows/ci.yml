name: CI

on:
    push:
      branches: [master]
    pull_request:
      branches: [master]

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            
            - name: Setup Python
              uses: actions/setup-python@v5
              id: py
              with:
                python-version: "3.11"
                
            - name: Setup uv
              uses: astral-sh/setup-uv@v4
              with:
                enable-cache: true
                cache-dependency-glob: |
                  **/*requirements*.txt
                  **/pyproject.toml
                  **/uv.lock

            - name: Install (dev)
              run: uv sync --dev

            - name: Run tests
              env:
                KUZU_DB_PATH: ./var/ci.kuzu
              run: uv run pytest -q